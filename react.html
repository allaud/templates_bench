<!DOCTYPE html>
<html>
<head>
  <meta charset=utf-8 />
  <title></title>
  <script type="text/javascript" src="react.js"></script>
  <script type="text/javascript" src="immutable.min.js"></script>
  <script type="text/javascript" src="ticket.js"></script>

  <style type="text/css">
  .ticket{
    float: left;
    border: 1px solid red;
  }
  .ticket > div{
    float: left;
  }
  </style>


  <!--[if IE]>
    <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
</head>
<body>
  <div id="test"></div>
  <script type="text/javascript">
    tickets = [];
    data = {};
    for(j=0;j<100;j++){
      for(i=0;i<300;i++){
        data['test' + i] = Math.random();
      }
      tickets.push(data);
    }

    console.log('cache: ', 0);

    container = document.getElementById('test');
    t = +(new Date());

    //ticket_obj = React.render(React.createElement(ticket, {data: data}), container);
    var Wrapper = React.createClass({
      displayName: "Wrapper",
      getInitialState: function() {
        return {tickets: this.props.data};
      },
      getTickets: function(){
        return this.state.tickets;
      },
      render: function() {
        var rows = [];
        for (var i=0; i < 100; i++) {
          rows.push(React.createElement(Ticket, {
            getTickets: this.getTickets,
            index: i,
            ticket: this.state.tickets[i]
          }));
        }
        return React.createElement("div", null, rows);
      }
    });
    wrapper_obj = React.render(React.createElement(Wrapper, {data: tickets}), container);

    console.log('draw: ', +(new Date()) - t);

    t = +(new Date());
    wrapper_obj.setState({tickets: tickets});
    console.log('redraw0', +(new Date()) - t);

    t = +(new Date());
    changed_ticket = React.addons.update(tickets[1], {'test5': {$set: 'asdasdasdasdsdsdsdsdsdsdsdasdasdasdasdasd'}})
    new_tickets = React.addons.update(tickets, {$splice: [[1, 1, changed_ticket]]});
    wrapper_obj.setState({tickets: new_tickets});
    console.log('redraw1', +(new Date()) - t);

    t = +(new Date());
    new_zero_ticket = React.addons.update(tickets[0], {'test1': {$set: '00000000'}});
    new_zero_ticket = React.addons.update(new_zero_ticket, {'test2': {$set: '00000000'}});
    new_tickets = React.addons.update(new_tickets, {$splice: [[0, 1, new_zero_ticket]]});

    new_1_ticket = React.addons.update(tickets[1], {'test1': {$set: '00000000'}});
    new_tickets = React.addons.update(new_tickets, {$splice: [[1, 1, new_1_ticket]]});

    new_2_ticket = React.addons.update(tickets[2], {'test2': {$set: 'XXXXXXXXX'}});
    new_tickets = React.addons.update(new_tickets, {$splice: [[2, 1, new_2_ticket]]});

    wrapper_obj.setState({tickets: new_tickets});
    console.log('redraw2', +(new Date()) - t);

  </script>
</body>
</html>
